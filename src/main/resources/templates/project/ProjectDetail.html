<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/ProjectDetail.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
  <script src="/js/jquery-3.7.0.min.js"></script>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  
 
  <title>Document</title>
</head>
<body>

<th:block th:replace=" ~{/include/layout_engineer :: setContent(~{ :: #container})}">

  <div id="container">
    <div class="titleZone">
      <div class="titleArea">
        <p class="projectTitle">[[${pVO.pjt_nm}]]</p>
      </div>

        <div class="tabMenuArea">
          <div class="tabList">
            <p class="firstTab on">개요</p>
            <p class="secondTab">세부정보</p>
            <p class="thirdTab">멤버</p>
          </div>
        </div>
    </div>

    <div class="contentZone">
      
      <!-- 개요 탭에서 보여질 부분 -->
      <div class="taskInfoArea">
        <div class="taskProgressArea">
          <div class="taskProgress" style="line-height: 400px;">
			  <p class="errMsg">[[${errMsg}]]</p>
			  <div id="taskGraph">
			  </div>
          </div>
        </div>
        <div class="taskCardArea">
			
          <div class="taskCardContainer" th:each="tVO : ${tList}">
            <div class="taskCard">
              <div class="taskTitleArea">
                <p class="taskTitle">[[${tVO.task_nm}]]</p>
                <a class="taskOption"><i class="bi bi-three-dots-vertical"></i></a>
                <div class="taskOptionMenu hidden">
                  <p style="border-bottom: 1px solid rgb(230, 235, 241);">작업 수정</p>
                  <p>작업 삭제</p>
                </div>
              </div>
              <div class="taskContentArea">
                <div class="taskDetailArea">
                  <p class="taskDetail">[[${tVO.task_dtl}]]</p>
                </div>
                <div class="taskStatusDateArea">
                  <p class="taskStatus">[[${tVO.status}]]</p>
                  <p class="taskDate">[[${#temporals.format(tVO.task_end_dt, 'MM/dd HH:mm')}]]</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 프로젝트 정보 -->
      <div class="projectInfoArea">
        <div class="projectInfoContainer">
          <div class="contentArea">
            <div class="shortFormArea">
              <ul>
                <li>
                  <p>프로젝트 이름</p><input type="text" name="pjt_nm" class="pjt_nm" readonly th:value="${pVO.pjt_nm}"/>
                </li>
                <li>
                  <p>서버 종류</p>
                  <input type="text" readonly name="server_model" class="server_model" th:value="${pVO.server_model}"/>
                </li>
                <li>
                  <div>
                    <p>시작일</p><input type="date" name="pjt_st_dt" readonly th:value="${pVO.pjt_st_dt}"/>
                  </div>
                  <div>
                    <p>마감일</p><input type="date" name="pjt_end_dt" readonly th:value="${pVO.pjt_end_dt}"/>
                  </div>
                </li>
              </ul>
            </div>
              <div class="detailFormArea">
                <div class="upperDetailFormArea">
                  <div class="detailFormAreaLeft">
                    <p style="margin-bottom: 20px; font-size: 20px;">프로젝트 내용</p>
                  </div>
                  <div class="detailFormAreaRight">
                  </div>
                </div>
                <textarea name="pjt_dtl" class="pjt_dtl" readonly>[[${pVO.pjt_dtl}]]</textarea>
    
              </div>
          </div>
        </div>
      </div>


      <!-- 멤버 정보 -->
      <div class="memberInfoArea">

        <div class="memberInfoAreaContainer">

          <div class="requestUserInfo">
            <p class="requestUser">고객사</p>
            <div class="requestUserList">
              <ul>
                <li>
                  <p>[[${cusUList.user_group}]]</p>
                  <p>[[${cusUList.user_email}]]</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="adminUserInfo">
            <p class="adminUser">관리자</p>
            <div class="adminUserList">
              <ul>
                <li>
                  <p>[[${adUList.user_nm}]]</p>
                  <p>[[${adUList.user_email}]]</p>
                  <p>[[${adUList.user_group}]]</p>
                  <p>[[${adUList.user_role}]]</p>
                </li>
              </ul>
            </div>

          </div>
          <div class="normalUserInfo">
            <p class="normalUser">작업자<i class="bi bi-plus-square memberAdd" data-bs-toggle="modal" data-bs-target="#addMemberModal"></i></p>
            <div class="normalUserList">
              <ul>
                <li th:each="eVO : ${engiUList}">
                  <p>[[${eVO.user_nm}]]</p>
                  <p>[[${eVO.user_email}]]</p>
                  <p>[[${eVO.user_group}]]</p>
                  <p>[[${eVO.user_role}]]</p>
                </li>
              </ul>
            </div>
          </div>

        </div>

      </div>

      <div class="modalArea">
		<div class="modal fade" id="addMemberModal" tabindex="-1" aria-labelledby="exampleModalLabel"
			aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">작업자 추가</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="memberListContainer">
							<div class="memberProfileZone">
								<form method="post" action="updateMemberForm" id="updateMemberForm">
									<input hidden type="text" th:value="${pVO.pjt_id}" name="pjt_id"/>
									<ul class="memberProfileList"></ul>
								</form>
							</div>
							<div class="memberListZone">
								<ul>
									<li th:each="notUVO : ${notAddedList}">
										<p th:class="${notUVO.user_id}">[[${notUVO.user_nm}]]</p>
										<p class="email">[[${notUVO.user_email}]]</p><i class="bi bi-check-square memberAddBtn"></i>
										<p class="user_idHidden" hidden>[[${notUVO.user_id}]]</p>
									</li>
								</ul>
							</div>
						</div>
						<div class="pageNation">
							<ul>
								<th:block th:each="page : ${pageVO.pageList}">
									<li><a class="pages">[[${page}]]</a></li>
								</th:block>
							</ul>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary updateMemBtn" data-bs-dismiss="modal">추가</button>
					</div>
				</div>
			</div>
		</div>
	</div>




    </div>
  </div>
  
  </th:block>

  <script th:inline="javascript">

    window.onload = () => {
      $('.taskInfoArea').toggle(true);
        $('.projectInfoArea').toggle(false);
        $('.memberInfoArea').toggle(false);
    }

    // 탭 전환 기능
    $('.tabList').click((e) => {
      if(e.target.tagName != "P") return;
      $('.tabList').children().removeClass('on');
      e.target.classList.add('on');
      $('.taskInfoArea').toggle();

      if(e.target.innerHTML === "개요") {
        $('.taskInfoArea').toggle(true);
        $('.projectInfoArea').toggle(false);
        $('.memberInfoArea').toggle(false);
      } else if(e.target.innerHTML === '세부정보'){
        $('.taskInfoArea').toggle(false);
        $('.projectInfoArea').toggle(true);
        $('.memberInfoArea').toggle(false);
      } else {
        $('.taskInfoArea').toggle(false);
        $('.projectInfoArea').toggle(false);
        $('.memberInfoArea').toggle(true);
      }
    });


    // 작업 옵션 열기
    $('.taskOption').click((e) => {
		console.log(e.target);
		e.target.parentElement.nextElementSibling.classList.toggle("hidden");
		e.target.parentElement.classList.toggle("optionOpen");
    })

    // 멤버 추가 버튼
    $('.memberAdd').mousedown(() => {
      $('.memberAdd').toggleClass('bi-plus-square');
      $('.memberAdd').toggleClass('bi-plus-square-fill');
    })

    $('.memberAdd').mouseup(() => {
      $('.memberAdd').toggleClass('bi-plus-square');
      $('.memberAdd').toggleClass('bi-plus-square-fill');
    })


	$('.memberAddBtn').click((e) => {

		var currName = $(e.target).parent().children().first().attr("class");

		if ($(e.target).hasClass('bi-check-square-fill')) {
			$('.memberProfileList').children('.' + currName).remove();
		} else {
			$('.memberProfileList').append('<li class="' + $(e.target).parent().children().first().attr("class") + '"><p>' + $(e.target).parent().children().first().text() + '</p><p>' + $(e.target).parent().children('.email').text() + '</p><input type="text" hidden name="users" value="' + $(e.target).parent().children('.user_idHidden').text() +'"/></li>');

		}

		$(e.target).toggleClass('bi-check-square bi-check-square-fill');

	});    
    
    
      
      var chartPjt_date = [[${chartPjt_date}]];
      var chartCompleteTask = [[${chartCompleteTask}]];
      
      
      if(!chartCompleteTask.includes(null)){
		  
      google.charts.load('current', {'packages':['corechart'], 'language' : 'kr'});
      google.charts.setOnLoadCallback(drawChart);
      
      
	
		  
      var exchart = [ ['date', '진행도'] ];
      for(var i = 0; i < chartPjt_date.length; i++){
		  exchart.push([chartPjt_date[i], chartCompleteTask[i]] );
	  }
		  

      function drawChart() {
		  
        var data = google.visualization.arrayToDataTable(exchart);

        var options = {
          title: '작업 진행',
          curveType: 'none',
          
          legend: { position: 'bottom' },
           vAxis: {
            viewWindow: {
                max: 100, // Set the maximum value for the y-axis
                min: 0
            }
        }
        };

        var chart = new google.visualization.LineChart(document.getElementById('taskGraph'));

        chart.draw(data, options);
      }
		  
	  }
    
      
	$('.updateMemBtn').click(function(){
		alert('작업자 정보가 업데이트 되었습니다.');
		$('#updateMemberForm').submit();
	});
    

  </script>


  
</body>
</html>